{% extends 'base.html' %}

{% load static %}

{% block title %}Manage FIRs - Safe Call{% endblock %}

{% block styles %}
{{ block.super }} 
<!-- Add Linearicons CSS -->
<link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">
<style>
    /* Container and Layout */
    .fir-container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .page-title {
        color: #f1f1f1;
        margin-bottom: 30px;
        text-align: center;
        font-size: 28px;
    }
    
    /* Complaint Card Styling */
    .complaint-card {
        background-color: #292929;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        transition: transform 0.2s ease-in-out;
    }
    
    .complaint-card:hover {
        transform: translateY(-5px);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: #333;
    }
    
    .card-title {
        font-size: 18px;
        font-weight: bold;
        margin: 0;
        display: flex;
        align-items: center;
    }
    
    /* Status Badges */
    .status-badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 14px;
        font-weight: bold;
    }
    
    .status-pending {
        background-color: #FFC107;
        color: #212121;
    }
    
    .status-investigation {
        background-color: #3F51B5;
        color: white;
    }
    
    .status-resolved {
        background-color: #4CAF50;
        color: white;
    }
    
    .status-rejected {
        background-color: #F44336;
        color: white;
    }
    
    /* Card Body */
    .card-body {
        padding: 20px;
    }
    
    /* Details Grid */
    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }
    
    .grid-item {
        margin-bottom: 15px;
    }
    
    .full-width {
        grid-column: 1 / -1;
    }
    
    .additional-descriptions {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 300px;
        overflow-y: auto;
    }
    
    .additional-description-item {
        background-color: #333;
        border-radius: 5px;
        padding: 10px;
        border-left: 3px solid #2196F3;
    }
    
    .description-timestamp {
        font-size: 12px;
        color: #aaa;
        margin-bottom: 5px;
    }
    
    .description-content {
        color: #f1f1f1;
        line-height: 1.5;
    }
    
    .no-descriptions {
        color: #888;
        font-style: italic;
    }
    
    .detail-item {
        margin-bottom: 10px;
    }
    
    .detail-label {
        font-size: 14px;
        color: #aaaaaa;
        margin-bottom: 5px;
    }
    
    .detail-value {
        font-size: 16px;
        color: #f1f1f1;
    }
    
    /* Description Section */
    .description-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #444;
    }
    
    .description-label {
        font-size: 16px;
        color: #aaaaaa;
        margin-bottom: 10px;
    }
    
    .description-content {
        background-color: #333;
        padding: 15px;
        border-radius: 5px;
        line-height: 1.6;
        color: #f1f1f1;
    }
    
    /* Evidence Section */
    .evidence-section {
        margin-top: 20px;
    }
    
    .evidence-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .evidence-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background-color: #444;
        border-radius: 5px;
        margin-bottom: 10px;
    }

    .evidence-item:last-child {
        margin-bottom: 0;
    }

    .evidence-item i {
        font-size: 18px;
        color: #2196F3;
    }

    .evidence-item a {
        color: #fff;
        text-decoration: none;
        flex: 1;
    }

    .evidence-item.no-evidence {
        background-color: #333;
        color: #888;
    }

    .evidence-item.no-evidence i {
        color: #F44336;
    }

    .evidence-link {
        display: inline-flex;
        align-items: center;
        background-color: #444;
        color: #fff;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.2s;
        margin-right: 10px;
    }
    
    .evidence-link:hover {
        background-color: #555;
    }
    
    .evidence-icon {
        margin-right: 10px;
    }
    
    /* FIR Form */
    .fir-form {
        background-color: #333;
        padding: 20px;
        border-radius: 8px;
        margin-top: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #aaaaaa;
        font-size: 14px;
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        background-color: #444;
        border: 1px solid #555;
        border-radius: 5px;
        color: white;
        font-size: 16px;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #2196F3;
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
    }
    
    /* Witness Section */
    .witness-section {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #444;
    }
    
    .witness-list {
        margin-top: 15px;
    }
    
    .witness-item {
        background-color: #444;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        position: relative;
    }
    
    .witness-item .remove-witness {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
    }
    
    .witness-item .remove-witness:hover {
        background-color: #c82333;
    }
    
    /* Buttons */
    .btn-primary {
        background-color: #2196F3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.2s, transform 0.1s;
    }
    
    .btn-primary:hover {
        background-color: #0b7dda;
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background-color: #6c757d;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        text-decoration: none;
        transition: background-color 0.2s, transform 0.1s;
        margin-left: 10px;
    }
    
    .btn-secondary:hover {
        background-color: #5a6268;
        transform: translateY(-2px);
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        background-color: #292929;
        border-radius: 8px;
    }
    
    .empty-state-icon {
        font-size: 60px;
        margin-bottom: 20px;
        color: #555;
    }
    
    .empty-state-title {
        font-size: 24px;
        margin-bottom: 10px;
        color: #f1f1f1;
    }
    
    .empty-state-text {
        font-size: 16px;
        color: #aaaaaa;
        margin-bottom: 30px;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .page-title {
            font-size: 24px;
        }
        
        .card-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .status-badge {
            margin-top: 10px;
        }
        
        .details-grid {
            grid-template-columns: 1fr;
        }
        
        .fir-form {
            padding: 15px;
        }
        
        .btn-secondary {
            margin-left: 0;
            margin-top: 10px;
        }
    }
    
    /* Add Evidence Form */
    .add-evidence-form {
        margin-top: 20px;
        padding: 15px;
        background-color: #333;
        border-radius: 5px;
    }
    
    .add-evidence-form .form-group {
        margin-bottom: 15px;
    }
    
    /* Add Witness Form */
    .add-witness-form {
        margin-top: 20px;
        padding: 15px;
        background-color: #333;
        border-radius: 5px;
    }
    
    .witness-form-fields {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 10px;
    }
    
    .witness-form-fields .form-control {
        margin-bottom: 0;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .witness-form-fields {
            grid-template-columns: 1fr;
        }
    }
    
    /* Complainant Details Section */
    .complainant-section {
        background-color: #333;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        border-left: 4px solid #2196F3;
    }

    .complainant-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #444;
    }

    .complainant-photo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 20px;
        border: 3px solid #2196F3;
    }

    .complainant-info {
        flex: 1;
    }

    .complainant-name {
        font-size: 20px;
        color: #fff;
        margin-bottom: 5px;
    }

    .complainant-contact {
        display: flex;
        gap: 20px;
        color: #aaa;
        font-size: 14px;
    }

    .complainant-details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 15px;
    }

    .complainant-detail-item {
        background-color: #292929;
        padding: 15px;
        border-radius: 5px;
    }

    .complainant-detail-label {
        color: #888;
        font-size: 12px;
        margin-bottom: 5px;
        text-transform: uppercase;
    }

    .complainant-detail-value {
        color: #fff;
        font-size: 14px;
    }

    .complainant-detail-value.empty {
        color: #666;
        font-style: italic;
    }

    .contact-icon {
        margin-right: 5px;
        color: #2196F3;
    }
    
    /* Complaint Details Section */
    .complaint-details-section {
        background-color: #333;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .complaint-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .complaint-title {
        font-size: 18px;
        color: #f1f1f1;
        margin: 0;
    }
    
    .complaint-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .complaint-item {
        background-color: #444;
        padding: 15px;
        border-radius: 5px;
    }
    
    .complaint-label {
        font-size: 14px;
        color: #aaaaaa;
        margin-bottom: 5px;
    }
    
    .complaint-value {
        font-size: 16px;
        color: #f1f1f1;
    }
    
    /* Section Styles */
    .section-container {
        margin-bottom: 15px;
    }
    
    .section-header {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        background-color: #333;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        position: relative;
        z-index: 1;
    }
    
    .section-header:hover {
        background-color: #444;
    }
    
    .section-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #2196F3;
        border-radius: 50%;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .section-icon i {
        color: white;
        font-size: 20px;
    }
    
    .section-title {
        font-size: 18px;
        color: #f1f1f1;
        margin: 0;
        flex-grow: 1;
    }
    
    .section-header .fa-chevron-down {
        color: #f1f1f1;
        font-size: 16px;
        transition: transform 0.3s ease;
        margin-left: 10px;
    }
    
    .section-header.active .fa-chevron-down {
        transform: rotate(180deg);
    }
    
    .section-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
        background-color: #292929;
        border-radius: 0 0 8px 8px;
        position: relative;
        z-index: 0;
    }
    
    .section-content.active {
        max-height: none;
    }
    
    .section-body {
        padding: 20px;
    }
    
    /* Grid Layouts */
    .grid-layout {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .grid-item {
        background-color: #333;
        padding: 20px;
        border-radius: 8px;
        position: relative;
        z-index: 1;
    }
    
    .grid-label {
        font-size: 14px;
        color: #aaaaaa;
        margin-bottom: 5px;
    }
    
    .grid-value {
        font-size: 16px;
        color: #f1f1f1;
    }
    
    /* Description Box */
    .description-box {
        background-color: #333;
        padding: 15px;
        border-radius: 5px;
        line-height: 1.6;
    }
    
    /* Evidence List */
    .evidence-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .evidence-item {
        background-color: #333;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 15px;
        position: relative;
        z-index: 1;
    }
    
    .evidence-item i {
        color: #2196F3;
        font-size: 20px;
        flex-shrink: 0;
    }
    
    .evidence-item a {
        color: #f1f1f1;
        text-decoration: none;
        flex-grow: 1;
        word-break: break-word;
    }
    
    /* Witness List */
    .witness-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .witness-item {
        background-color: #333;
        padding: 20px;
        border-radius: 8px;
        position: relative;
        z-index: 1;
    }
    
    /* Animation Keyframes */
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .section-content.active {
        animation: slideDown 0.3s ease-out;
    }

    /* Quick Actions Section */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
        padding: 20px;
        background-color: #333;
        border-radius: 8px;
    }

    .quick-action-form {
        background-color: #444;
        padding: 20px;
        border-radius: 8px;
    }

    .quick-action-form .form-group {
        margin-bottom: 15px;
    }

    .quick-action-form .form-label {
        color: #f1f1f1;
        margin-bottom: 8px;
        display: block;
    }

    .quick-action-form .form-control {
        background-color: #555;
        border: 1px solid #666;
        color: #f1f1f1;
        padding: 10px;
        border-radius: 5px;
        width: 100%;
    }

    .quick-action-form .form-control:focus {
        border-color: #2196F3;
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
    }

    .quick-action-form .form-text {
        color: #aaaaaa;
        font-size: 12px;
        margin-top: 5px;
    }

    .witness-form-fields {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
    }

    .quick-action-form .btn-secondary {
        width: 100%;
        margin-top: 10px;
        background-color: #2196F3;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .quick-action-form .btn-secondary:hover {
        background-color: #1976D2;
    }

    @media (max-width: 768px) {
        .quick-actions {
            grid-template-columns: 1fr;
            padding: 15px;
        }
        
        .witness-form-fields {
            grid-template-columns: 1fr;
        }
    }

    /* Search and Filter Section */
    .search-filter-section {
        background: #2a2a2a;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        position: relative;
        z-index: 2;
    }

    .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .search-fields {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        flex: 1;
    }

    .search-field input {
        width: 100%;
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        background-color: #444;
        color: #f1f1f1;
        font-size: 14px;
    }

    .search-field input:focus {
        outline: none;
        background-color: #555;
    }

    .search-button {
        padding: 12px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .search-button:hover {
        background-color: #0056b3;
    }

    .filter-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .filter-label {
        color: #f1f1f1;
        font-size: 14px;
    }

    .filter-select {
        padding: 8px;
        border-radius: 5px;
        background-color: #444;
        color: #f1f1f1;
        border: none;
    }

    .date-range {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .date-input {
        padding: 8px;
        border-radius: 5px;
        background-color: #444;
        color: #f1f1f1;
        border: none;
    }

    .filter-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    .btn-primary, .btn-secondary {
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
        border: none;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
        border: none;
        text-decoration: none;
    }

    .btn-primary:hover {
        background-color: #0056b3;
    }

    .btn-secondary:hover {
        background-color: #545b62;
    }

    .filter-tag {
        display: inline-block;
        padding: 5px 10px;
        background-color: #444;
        color: #f1f1f1;
        border-radius: 15px;
        margin: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .filter-tag:hover {
        background-color: #555;
    }

    @media (max-width: 768px) {
        .search-fields {
            grid-template-columns: 1fr;
        }
        
        .search-box {
            flex-direction: column;
        }
        
        .search-button {
            width: 100%;
        }
        
        .filter-options {
            grid-template-columns: 1fr;
        }
    }

    .search-results-info {
        margin: 20px 0;
        padding: 15px;
        background-color: #333;
        border-radius: 8px;
    }

    .active-filters {
        color: #f1f1f1;
    }

    .active-filters h4 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #aaaaaa;
    }

    .filter-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .filter-tag::after {
        content: '×';
        margin-left: 5px;
        cursor: pointer;
        opacity: 0.7;
    }

    .filter-tag:hover::after {
        opacity: 1;
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin-top: 40px;
        position: relative;
        z-index: 1;
    }

    .page-link {
        padding: 8px 12px;
        background-color: #333;
        color: #f1f1f1;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.2s;
    }

    .page-link:hover {
        background-color: #444;
    }

    .page-link.active {
        background-color: #2196F3;
        color: white;
    }

    @media (max-width: 768px) {
        .filter-tags {
            flex-direction: column;
        }
        
        .pagination {
            flex-wrap: wrap;
        }
    }

    /* Add these styles to your existing CSS */
    .search-fields {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        flex: 1;
    }

    .search-field {
        position: relative;
    }

    .search-field input {
        width: 100%;
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        background-color: #444;
        color: #f1f1f1;
        font-size: 14px;
    }

    .search-field input:focus {
        outline: none;
        background-color: #555;
    }

    @media (max-width: 768px) {
        .search-fields {
            grid-template-columns: 1fr;
        }
        
        .search-box {
            flex-direction: column;
        }
        
        .search-button {
            width: 100%;
            margin-top: 10px;
        }
    }

    .error-message {
        color: #F44336;
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }
    
    .description-validation {
        font-size: 12px;
        color: #777;
        margin-top: 5px;
        text-align: right;
    }
    
    #charCount {
        font-weight: bold;
        color: #4caf50;
    }
    
    textarea:focus {
        border-color: #2196F3;
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.25);
    }

    .form-control.error {
        border-color: #ff4444;
    }

    .form-control.error:focus {
        box-shadow: 0 0 0 2px rgba(255, 68, 68, 0.25);
    }

    /* Update section icon styles */
    .section-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #2196F3;
        border-radius: 50%;
        margin-right: 15px;
        flex-shrink: 0;
    }
    
    .section-icon i {
        color: white;
        font-size: 20px;
    }

    /* Add specific icon colors for different sections */
    .section-icon.complainant {
        background-color: #4CAF50;  /* Green for complainant */
    }
    
    .section-icon.complaint {
        background-color: #FF9800;  /* Orange for complaint */
    }
    
    .section-icon.description {
        background-color: #9C27B0;  /* Purple for description */
    }
    
    .section-icon.evidence {
        background-color: #F44336;  /* Red for evidence */
    }
    
    .section-icon.witness {
        background-color: #2196F3;  /* Blue for witness */
    }
    
    .section-icon.fir {
        background-color: #607D8B;  /* Grey for FIR */
    }

    /* Print-specific styles */
    @media print {
        body * {
            visibility: hidden;
        }
        #reportContent, #reportContent * {
            visibility: visible;
        }
        #reportContent {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
        .modal-footer {
            display: none !important;
        }
    }

    .form-group button {
        margin-top: 10px;
    }
    
    /* View report button styles */
    .fir-actions {
        margin: 20px 0;
        display: flex;
        justify-content: center;
    }
    
    .view-report-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        font-weight: 500;
    }
    
    .view-report-btn:hover {
        background-color: #0056b3;
    }
    
    .view-report-btn i {
        font-size: 1.1em;
    }
</style>
{% endblock %}

{% block content %}
<div class="fir-container">
    <h1 class="page-title">Manage FIRs</h1>
    
    <!-- Search and Filter Section -->
    <div class="search-filter-section">
        <form method="get" class="search-form" id="searchFilterForm">
            <div class="search-box">
                <div class="search-fields">
                    <div class="search-field">
                        <input type="text" name="search_id" class="search-input" placeholder="Search by ID..." value="{{ search_id }}" pattern="^[0-9]*$" title="Please enter numbers only">
                    </div>
                    <div class="search-field">
                        <input type="text" name="search_name" class="search-input" placeholder="Search by name..." value="{{ search_name }}">
                    </div>
                    <div class="search-field">
                        <input type="text" name="search_location" class="search-input" placeholder="Search by location..." value="{{ search_location }}">
                    </div>
                    <div class="search-field">
                        <input type="text" name="search_type" class="search-input" placeholder="Search by type..." value="{{ search_type }}">
                    </div>
                    <div class="search-field">
                        <input type="text" name="search_description" class="search-input" placeholder="Search in description..." value="{{ search_description }}">
                    </div>
                </div>
                <button type="submit" class="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div class="filter-options">
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <select name="status" class="filter-select" onchange="this.form.submit()">
                        <option value="">All Status</option>
                        {% for status_value, status_label in status_choices %}
                            <option value="{{ status_value }}" {% if current_status == status_value %}selected{% endif %}>
                                {{ status_label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Complaint Type</label>
                    <select name="complaint_type" class="filter-select" onchange="this.form.submit()">
                        <option value="">All Types</option>
                        {% for type_value, type_label in complaint_types %}
                            <option value="{{ type_value }}" {% if current_complaint_type == type_value %}selected{% endif %}>
                                {{ type_label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Date Range</label>
                    <div class="date-range">
                        <input type="date" name="start_date" class="date-input" value="{{ start_date }}" max="{{ today_date|date:'Y-m-d' }}" onchange="validateDateRange(this.form)">
                        <span>to</span>
                        <input type="date" name="end_date" class="date-input" value="{{ end_date }}" max="{{ today_date|date:'Y-m-d' }}" onchange="validateDateRange(this.form)">
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Time of Day</label>
                    <select name="incident_time" class="filter-select" onchange="this.form.submit()">
                        <option value="">All Times</option>
                        {% for time_value, time_label in time_choices %}
                            <option value="{{ time_value }}" {% if current_incident_time == time_value %}selected{% endif %}>
                                {{ time_label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select name="sort" class="filter-select" onchange="this.form.submit()">
                        <option value="newest" {% if current_sort == 'newest' %}selected{% endif %}>Newest First</option>
                        <option value="oldest" {% if current_sort == 'oldest' %}selected{% endif %}>Oldest First</option>
                    </select>
                </div>
            </div>

            <div class="filter-actions">
                <button type="submit" class="btn-primary">Apply Filters</button>
                <a href="{% url 'manage_fir' %}" class="btn-secondary">Clear Filters</a>
            </div>
        </form>
    </div>

    <!-- Search Results Info -->
    <div class="search-results-info">
        {% if search_id or search_name or search_location or search_type or search_description or current_status or current_complaint_type or current_incident_time or start_date or end_date %}
            <div class="active-filters">
                <h4>Active Filters ({{ total_results }} results):</h4>
                <div class="filter-tags">
                    {% if search_id %}
                        <span class="filter-tag" data-field="search_id">ID: "{{ search_id }}"</span>
                    {% endif %}
                    {% if search_name %}
                        <span class="filter-tag" data-field="search_name">Name: "{{ search_name }}"</span>
                    {% endif %}
                    {% if search_location %}
                        <span class="filter-tag" data-field="search_location">Location: "{{ search_location }}"</span>
                    {% endif %}
                    {% if search_type %}
                        <span class="filter-tag" data-field="search_type">Type: "{{ search_type }}"</span>
                    {% endif %}
                    {% if search_description %}
                        <span class="filter-tag" data-field="search_description">Description: "{{ search_description }}"</span>
                    {% endif %}
                    {% if current_status %}
                        <span class="filter-tag" data-field="status">Status: {{ current_status }}</span>
                    {% endif %}
                    {% if current_complaint_type %}
                        <span class="filter-tag" data-field="complaint_type">Type: {{ current_complaint_type }}</span>
                    {% endif %}
                    {% if current_incident_time %}
                        <span class="filter-tag" data-field="incident_time">Time: {{ current_incident_time }}</span>
                    {% endif %}
                    {% if start_date %}
                        <span class="filter-tag" data-field="start_date">From: {{ start_date }}</span>
                    {% endif %}
                    {% if end_date %}
                        <span class="filter-tag" data-field="end_date">To: {{ end_date }}</span>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

    {% if complaints %}
        {% for complaint in complaints %}
            <div class="complaint-card">
                <div class="card-header">
                    <h2 class="card-title">Complaint #{{ complaint.id }}</h2>
                    <span class="status-badge status-{{ complaint.status|lower }}">{{ complaint.get_status_display }}</span>
                </div>
                
                <div class="card-body">
                    <!-- Complainant Details Section -->
                    <div class="complainant-section">
                        <div class="complainant-header">
                            {% if complaint.user.profile_picture %}
                                <img src="{{ complaint.user.profile_picture.url }}" alt="Complainant Photo" class="complainant-photo">
                            {% else %}
                                <img src="{% static 'images/default_profile.png' %}" alt="Default Profile" class="complainant-photo">
                            {% endif %}
                            <div class="complainant-info">
                                <h3 class="complainant-name">{{ complaint.user.first_name }} {{ complaint.user.last_name }}</h3>
                                <div class="complainant-contact">
                                    <span><i class="fas fa-envelope contact-icon"></i>{{ complaint.user.email }}</span>
                                    {% if complaint.user.phone %}
                                        <span><i class="fas fa-phone contact-icon"></i>{{ complaint.user.phone }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="complainant-details-grid">
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">Adhaar Number</div>
                                <div class="complainant-detail-value">{{ complaint.user.adhaar }}</div>
                            </div>
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">Date of Birth</div>
                                <div class="complainant-detail-value {% if not complaint.user.date_of_birth %}empty{% endif %}">
                                    {{ complaint.user.date_of_birth|date:"F d, Y"|default:"Not provided" }}
                                </div>
                            </div>
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">Gender</div>
                                <div class="complainant-detail-value {% if not complaint.user.gender %}empty{% endif %}">
                                    {{ complaint.user.gender|default:"Not provided" }}
                                </div>
                            </div>
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">Address</div>
                                <div class="complainant-detail-value {% if not complaint.user.address %}empty{% endif %}">
                                    {{ complaint.user.address|default:"Not provided" }}
                                </div>
                            </div>
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">District</div>
                                <div class="complainant-detail-value {% if not complaint.user.district %}empty{% endif %}">
                                    {{ complaint.user.district|default:"Not provided" }}
                                </div>
                            </div>
                            <div class="complainant-detail-item">
                                <div class="complainant-detail-label">Pincode</div>
                                <div class="complainant-detail-value {% if not complaint.user.pincode %}empty{% endif %}">
                                    {{ complaint.user.pincode|default:"Not provided" }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Complaint Details Section -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(this)">
                            <div class="section-icon complaint">
                                <i class="lnr lnr-file-empty"></i>
                            </div>
                            <h3 class="section-title">Complaint Details</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="section-content">
                            <div class="section-body">
                                <div class="grid-layout">
                                    <div class="grid-item">
                                        <div class="grid-label">Complaint Type</div>
                                        <div class="grid-value">{{ complaint.get_complaint_type_display }}</div>
                                    </div>
                                    <div class="grid-item">
                                        <div class="grid-label">Incident Date</div>
                                        <div class="grid-value">{{ complaint.incident_date }}</div>
                                    </div>
                                    <div class="grid-item">
                                        <div class="grid-label">Incident Time</div>
                                        <div class="grid-value">{{ complaint.get_incident_time_display }}</div>
                                    </div>
                                    <div class="grid-item">
                                        <div class="grid-label">Incident Location</div>
                                        <div class="grid-value">{{ complaint.incident_location }}</div>
                                    </div>
                                    <div class="grid-item">
                                        <div class="grid-label">Registration Date</div>
                                        <div class="grid-value">{{ complaint.registered_at|date:"F j, Y, g:i a" }}</div>
                                    </div>
                                    <div class="grid-item">
                                        <div class="grid-label">Police Station</div>
                                        <div class="grid-value">{{ complaint.police_station.location }}, {{ complaint.police_station.district }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Complaint Description Section -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(this)">
                            <div class="section-icon description">
                                <i class="lnr lnr-text-align-left"></i>
                            </div>
                            <h3 class="section-title">Complaint Description</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="section-content">
                            <div class="section-body">
                                <div class="description-box">
                                    {{ complaint.description }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence Section -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(this)">
                            <div class="section-icon evidence">
                                <i class="lnr lnr-picture"></i>
                            </div>
                            <h3 class="section-title">Evidence</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="section-content">
                            <div class="section-body">
                                <div class="evidence-list">
                                    <div class="grid-item">
                                        <div class="grid-label">Public User Evidence</div>
                                        <div class="grid-value">
                                            {% if complaint.evidence %}
                                                <div class="evidence-item">
                                                    <i class="fas fa-file"></i>
                                                    <a href="{{ complaint.evidence.url }}" target="_blank">View Complaint Evidence</a>
                                                </div>
                                            {% else %}
                                                <div class="evidence-item no-evidence">
                                                    <i class="fas fa-times-circle"></i>
                                                    <span>No evidence uploaded</span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    {% if complaint.fir and complaint.fir.additional_evidence.exists %}
                                        <div class="grid-item">
                                            <div class="grid-label">Police Evidence</div>
                                            <div class="grid-value">
                                                {% for evidence in complaint.fir.additional_evidence.all %}
                                                    <div class="evidence-item">
                                                        <i class="fas fa-file"></i>
                                                        <a href="{{ evidence.file.url }}" target="_blank">View Police Evidence {{ forloop.counter }}</a>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Witness Section -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(this)">
                            <div class="section-icon witness">
                                <i class="lnr lnr-users"></i>
                            </div>
                            <h3 class="section-title">Witnesses</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="section-content">
                            <div class="section-body">
                                <div class="witness-list">
                                    {% if complaint.fir and complaint.fir.witnesses.exists %}
                                        {% for witness in complaint.fir.witnesses.all %}
                                            <div class="witness-item">
                                                <div class="grid-label">Name</div>
                                                <div class="grid-value">{{ witness.first_name }} {{ witness.last_name }}</div>
                                                <div class="grid-label">Phone</div>
                                                <div class="grid-value">{{ witness.phone_number }}</div>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions Section -->
                    <div class="quick-actions">
                        <!-- Add Evidence Form -->
                        <form method="post" action="{% url 'add_evidence_to_fir' complaint.id %}" enctype="multipart/form-data" class="quick-action-form" id="evidenceForm" onsubmit="return validateEvidenceForm(this)">
                            {% csrf_token %}
                            <div class="form-group">
                                <label class="form-label">Add Evidence</label>
                                <input type="file" name="evidence_file" class="form-control" accept="image/*,video/*,.pdf" required>
                                <small class="form-text">Supported formats: Images, Videos, PDF (Max size: 10MB)</small>
                                <div class="error-message" id="evidenceError"></div>
                            </div>
                            <button type="submit" class="btn-secondary">Add Evidence</button>
                        </form>

                        <!-- Add Witness Form -->
                        <form method="post" action="{% url 'add_witness_to_fir' complaint.id %}" class="quick-action-form" id="witnessForm" onsubmit="return validateWitnessForm(this)">
                            {% csrf_token %}
                            <div class="form-group">
                                <label class="form-label">Add Witness</label>
                                <div class="witness-form-fields">
                                    <input type="text" name="first_name" class="form-control" placeholder="First Name" required>
                                    <input type="text" name="last_name" class="form-control" placeholder="Last Name" required>
                                    <input type="tel" name="phone_number" class="form-control" placeholder="Phone Number" required>
                                </div>
                                <div class="error-message" id="witnessError"></div>
                            </div>
                            <button type="submit" class="btn-secondary">Add Witness</button>
                        </form>
                    </div>

                    <!-- FIR Details Section (Moved to last) -->
                    <div class="section-container">
                        <div class="section-header" onclick="toggleSection(this)">
                            <div class="section-icon fir">
                                <i class="lnr lnr-file-add"></i>
                            </div>
                            <h3 class="section-title">FIR Details</h3>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="section-content">
                            <div class="section-body">
                                {% if complaint.fir %}
                                    <div class="grid-layout">
                                        <div class="grid-item">
                                            <div class="grid-label">Spot Location</div>
                                            <div class="grid-value">{{ complaint.fir.spot_location }}</div>
                                        </div>
                                        <div class="grid-item">
                                            <div class="grid-label">Initial Police Description</div>
                                            <div class="grid-value">{{ complaint.fir.police_description }}</div>
                                        </div>
                                        <div class="grid-item full-width">
                                            <div class="grid-label">Additional Descriptions</div>
                                            <div class="grid-value">
                                                {% if complaint.fir.additional_descriptions.all %}
                                                    <div class="additional-descriptions">
                                                        {% for desc in complaint.fir.additional_descriptions.all %}
                                                            <div class="additional-description-item">
                                                                <div class="description-timestamp">{{ desc.created_at|date:"F j, Y, g:i a" }}</div>
                                                                <div class="description-content">{{ desc.description }}</div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    <p class="no-descriptions">No additional descriptions added yet.</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="grid-item">
                                            <div class="grid-label">Created At</div>
                                            <div class="grid-value">{{ complaint.fir.created_at|date:"F j, Y, g:i a" }}</div>
                                        </div>
                                        <div class="grid-item">
                                            <div class="grid-label">Last Updated</div>
                                            <div class="grid-value">{{ complaint.fir.updated_at|date:"F j, Y, g:i a" }}</div>
                                        </div>
                                    </div>

                                    {% if complaint.status == 'Resolved' %}
                                        <div class="fir-actions">
                                            <a href="{% url 'view_case_file' complaint.id %}" class="btn-primary view-report-btn" target="_blank">
                                                <i class="fas fa-file-alt"></i> View Complete FIR Report
                                            </a>
                                        </div>
                                    {% endif %}

                                    <!-- Add Description Form -->
                                    {% if complaint.status != 'Resolved' %}
                                        <div class="quick-actions">
                                            <form method="post" action="{% url 'add_description_to_fir' complaint.id %}" class="quick-action-form" id="descriptionForm" onsubmit="return validateDescriptionForm(this)">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <label class="form-label">Add Additional Description</label>
                                                    <textarea name="additional_description" class="form-control" rows="4" placeholder="Add more details or updates to the FIR report" required minlength="10" maxlength="5000" id="descriptionField"></textarea>
                                                    <div class="description-validation">
                                                        <span id="charCount">0</span>/5000 characters (minimum 10)
                                                    </div>
                                                    <div class="error-message" id="descriptionError"></div>
                                                </div>
                                                <button type="submit" class="btn-secondary">Add Description</button>
                                            </form>
                                            
                                            <form method="post" action="{% url 'resolve_complaint' complaint.id %}" class="resolve-form">
                                                {% csrf_token %}
                                                <button type="submit" class="btn-primary">Mark as Resolved</button>
                                            </form>
                                        </div>
                                    {% endif %}
                                {% else %}
                                     <form method="post" action="{% url 'create_fir' complaint.id %}" enctype="multipart/form-data" class="fir-form" id="createFirForm" onsubmit="return validateFirForm(this)">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <label class="form-label">Spot Location</label>
                                            <input type="text" name="spot_location" class="form-control" placeholder="Enter exact incident location" required minlength="5" maxlength="200">
                                        </div>
                                        
                                        <div class="form-group">
                                            <label class="form-label">Police Description</label>
                                            <textarea name="police_description" class="form-control" rows="4" placeholder="Provide detailed description of the incident" required minlength="20" maxlength="5000" id="policeDescriptionField"></textarea>
                                            <div class="description-validation">
                                                <span id="policeDescCharCount">0</span>/5000 characters (minimum 20)
                                            </div>
                                            <div class="error-message" id="policeDescriptionError"></div>
                                        </div>
                                        
                                        <div class="form-group">
                                            <button type="submit" class="btn-primary">Create FIR</button>
                                        </div>
                                    </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">📋</div>
            <h2 class="empty-state-title">No Complaints Found</h2>
            <p class="empty-state-text">There are no complaints registered in your jurisdiction at the moment.</p>
        </div>
    {% endif %}

    <!-- Add this at the bottom of the complaints list -->
    {% if complaints.has_other_pages %}
        <div class="pagination">
            {% if complaints.has_previous %}
                <a href="?page={{ complaints.previous_page_number }}{% if search_id %}&search_id={{ search_id }}{% endif %}{% if search_name %}&search_name={{ search_name }}{% endif %}{% if search_location %}&search_location={{ search_location }}{% endif %}{% if search_type %}&search_type={{ search_type }}{% endif %}{% if search_description %}&search_description={{ search_description }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if complaint_type %}&complaint_type={{ complaint_type }}{% endif %}{% if incident_time %}&incident_time={{ incident_time }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" class="page-link">&laquo; Previous</a>
            {% endif %}
            
            {% for num in complaints.paginator.page_range %}
                {% if complaints.number == num %}
                    <span class="page-link active">{{ num }}</span>
                {% else %}
                    <a href="?page={{ num }}{% if search_id %}&search_id={{ search_id }}{% endif %}{% if search_name %}&search_name={{ search_name }}{% endif %}{% if search_location %}&search_location={{ search_location }}{% endif %}{% if search_type %}&search_type={{ search_type }}{% endif %}{% if search_description %}&search_description={{ search_description }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if complaint_type %}&complaint_type={{ complaint_type }}{% endif %}{% if incident_time %}&incident_time={{ incident_time }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" class="page-link">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if complaints.has_next %}
                <a href="?page={{ complaints.next_page_number }}{% if search_id %}&search_id={{ search_id }}{% endif %}{% if search_name %}&search_name={{ search_name }}{% endif %}{% if search_location %}&search_location={{ search_location }}{% endif %}{% if search_type %}&search_type={{ search_type }}{% endif %}{% if search_description %}&search_description={{ search_description }}{% endif %}{% if status %}&status={{ status }}{% endif %}{% if complaint_type %}&complaint_type={{ complaint_type }}{% endif %}{% if incident_time %}&incident_time={{ incident_time }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}" class="page-link">Next &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Complete Report Modal -->
<!-- <div class="modal fade" id="completeReportModal" tabindex="-1" aria-labelledby="completeReportModalLabel" aria-hidden="true">
    <!-- <div class="modal-dialog modal-lg">
        <!-- <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="completeReportModalLabel">Complete FIR Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="reportContent">
                <!-- Report content will be loaded here -->
            </div> -->
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="printReport()">Print Report</button>
            </div> -->
        </div> -->
    </div>
</div> -->

<script>
let evidenceCount = 0;
let witnessCount = 0;

function addEvidence() {
    const evidenceList = document.getElementById('evidence-list');
    const evidenceDiv = document.createElement('div');
    evidenceDiv.className = 'evidence-item';
    evidenceDiv.innerHTML = `
        <input type="file" name="additional_evidence[]" class="form-control" accept="image/*,video/*,.pdf" required>
        <button type="button" onclick="this.parentElement.remove()">Remove</button>
    `;
    evidenceList.appendChild(evidenceDiv);
    evidenceCount++;
}

function addWitness() {
    const witnessList = document.getElementById('witness-list');
    const witnessDiv = document.createElement('div');
    witnessDiv.className = 'witness-item';
    witnessDiv.innerHTML = `
        <button type="button" class="remove-witness" onclick="this.parentElement.remove()">Remove</button>
        <div class="form-group">
            <label class="form-label">First Name</label>
            <input type="text" name="witnesses[${witnessCount}][first_name]" class="form-control" required placeholder="Enter witness first name">
        </div>
        <div class="form-group">
            <label class="form-label">Last Name</label>
            <input type="text" name="witnesses[${witnessCount}][last_name]" class="form-control" required placeholder="Enter witness last name">
        </div>
        <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input type="tel" name="witnesses[${witnessCount}][phone_number]" class="form-control" required placeholder="Enter witness phone number">
        </div>
    `;
    witnessList.appendChild(witnessDiv);
    witnessCount++;
}

// Add initial evidence and witness fields
document.addEventListener('DOMContentLoaded', function() {
    addEvidence();
    addWitness();
});

function toggleSection(header) {
    const content = header.nextElementSibling;
    const isActive = header.classList.contains('active');
    
    // Toggle active class
    header.classList.toggle('active');
    content.classList.toggle('active');
    
    // Animate chevron icon
    const chevron = header.querySelector('.fa-chevron-down');
    chevron.style.transform = isActive ? 'rotate(0deg)' : 'rotate(180deg)';
}

// Initialize first section as active
document.addEventListener('DOMContentLoaded', function() {
    const firstSection = document.querySelector('.section-header');
    if (firstSection) {
        firstSection.classList.add('active');
        firstSection.nextElementSibling.classList.add('active');
        const chevron = firstSection.querySelector('.fa-chevron-down');
        if (chevron) {
            chevron.style.transform = 'rotate(180deg)';
        }
    }
    
    // Initialize character counter for description field
    const descriptionField = document.getElementById('descriptionField');
    if (descriptionField) {
        const charCount = document.getElementById('charCount');
        
        descriptionField.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            // Visual feedback based on character count
            if (count < 10) {
                charCount.style.color = '#f44336'; // Red for too short
            } else if (count > 4500) {
                charCount.style.color = '#ff9800'; // Orange for approaching limit
            } else {
                charCount.style.color = '#4caf50'; // Green for good length
            }
        });
    }
});

function validateDescriptionForm(form) {
    const descriptionField = form.querySelector('textarea[name="additional_description"]');
    const errorDiv = document.getElementById('descriptionError');
    
    // Reset error message
    errorDiv.textContent = '';
    errorDiv.style.display = 'none';
    
    // Validate description length
    const description = descriptionField.value.trim();
    if (description.length < 10) {
        errorDiv.textContent = 'Description must be at least 10 characters long';
        errorDiv.style.display = 'block';
        descriptionField.focus();
        return false;
    }
    
    if (description.length > 5000) {
        errorDiv.textContent = 'Description must not exceed 5000 characters';
        errorDiv.style.display = 'block';
        descriptionField.focus();
        return false;
    }
    
    return true;
}

function validateDateRange(form) {
    const startDateInput = form.querySelector('input[name="start_date"]');
    const endDateInput = form.querySelector('input[name="end_date"]');
    
    if (startDateInput.value && endDateInput.value) {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);
        
        if (startDate > endDate) {
            alert('Start date cannot be after end date');
            endDateInput.value = startDateInput.value;
        }
    }
    
    form.submit();
}

function validateFirForm(form) {
    const spotLocationField = form.querySelector('input[name="spot_location"]');
    const descriptionField = form.querySelector('textarea[name="police_description"]');
    const errorDiv = document.getElementById('policeDescriptionError');
    
    // Reset error messages
    errorDiv.textContent = '';
    errorDiv.style.display = 'none';
    
    // Validate spot location
    if (spotLocationField.value.trim().length < 5) {
        alert('Spot location must be at least 5 characters long');
        spotLocationField.focus();
        return false;
    }
    
    // Validate description length
    const description = descriptionField.value.trim();
    if (description.length < 20) {
        errorDiv.textContent = 'Police description must be at least 20 characters long';
        errorDiv.style.display = 'block';
        descriptionField.focus();
        return false;
    }
    
    if (description.length > 5000) {
        errorDiv.textContent = 'Police description must not exceed 5000 characters';
        errorDiv.style.display = 'block';
        descriptionField.focus();
        return false;
    }
    
    return true;
}

document.addEventListener('DOMContentLoaded', function() {
    // Initialize character counter for police description
    const policeDescField = document.getElementById('policeDescriptionField');
    if (policeDescField) {
        const policeCharCount = document.getElementById('policeDescCharCount');
        
        policeDescField.addEventListener('input', function() {
            const currentLength = this.value.length;
            policeCharCount.textContent = currentLength;
            
            if (currentLength > 5000) {
                policeCharCount.style.color = '#f44336'; // Red for over limit
            } else if (currentLength > 4000) {
                policeCharCount.style.color = '#ff9800'; // Orange for approaching limit
            } else {
                policeCharCount.style.color = '#4caf50'; // Green for good length
            }
        });
    }

    // Handle filter tag clicks
    document.querySelectorAll('.filter-tag').forEach(tag => {
        tag.addEventListener('click', function() {
            const field = this.dataset.field;
            const form = document.getElementById('searchFilterForm');
            
            // Clear the corresponding input/select
            const input = form.querySelector(`[name="${field}"]`);
            if (input) {
                input.value = '';
                form.submit();
            }
        });
    });

    // Handle form submission
    const form = document.getElementById('searchFilterForm');
    form.addEventListener('submit', function(e) {
        // Validate search ID is numeric
        const searchIdInput = form.querySelector('input[name="search_id"]');
        if (searchIdInput.value.trim() && !/^\d+$/.test(searchIdInput.value.trim())) {
            e.preventDefault();
            alert('Search ID must contain only numbers');
            searchIdInput.focus();
            return false;
        }
        
        // Validate date range
        const startDateInput = form.querySelector('input[name="start_date"]');
        const endDateInput = form.querySelector('input[name="end_date"]');
        
        if (startDateInput.value && endDateInput.value) {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            
            if (startDate > endDate) {
                e.preventDefault();
                alert('Start date cannot be after end date');
                return false;
            }
        }
        
        // Remove empty search fields from the form
        const inputs = form.querySelectorAll('input[type="text"]');
        inputs.forEach(input => {
            if (!input.value.trim()) {
                input.disabled = true;
            }
        });
    });
});

function validateEvidenceForm(form) {
    const fileInput = form.querySelector('input[type="file"]');
    const errorDiv = document.getElementById('evidenceError');
    const maxSize = 10 * 1024 * 1024; // 10MB in bytes
    
    // Reset error state
    fileInput.classList.remove('error');
    errorDiv.style.display = 'none';
    
    if (!fileInput.files.length) {
        errorDiv.textContent = 'Please select a file';
        errorDiv.style.display = 'block';
        fileInput.classList.add('error');
        return false;
    }
    
    const file = fileInput.files[0];
    const fileSize = file.size;
    const fileType = file.type;
    
    // Check file size
    if (fileSize > maxSize) {
        errorDiv.textContent = 'File size must be less than 10MB';
        errorDiv.style.display = 'block';
        fileInput.classList.add('error');
        return false;
    }
    
    // Check file type
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'video/mp4', 'video/quicktime', 'application/pdf'];
    if (!allowedTypes.includes(fileType)) {
        errorDiv.textContent = 'Invalid file type. Please upload an image, video, or PDF file';
        errorDiv.style.display = 'block';
        fileInput.classList.add('error');
        return false;
    }
    
    return true;
}

function validateWitnessForm(form) {
    const firstNameField = form.querySelector('input[name="first_name"]');
    const lastNameField = form.querySelector('input[name="last_name"]');
    const phoneField = form.querySelector('input[name="phone_number"]');
    const errorDiv = document.getElementById('witnessError');
    
    // Reset error message
    errorDiv.textContent = '';
    errorDiv.style.display = 'none';
    
    // Validate first name
    if (!firstNameField.value.trim()) {
        errorDiv.textContent = 'First name is required';
        errorDiv.style.display = 'block';
        firstNameField.focus();
        return false;
    }
    
    // Validate last name
    if (!lastNameField.value.trim()) {
        errorDiv.textContent = 'Last name is required';
        errorDiv.style.display = 'block';
        lastNameField.focus();
        return false;
    }
    
    // Validate phone number
    const phoneRegex = /^[0-9]{10}$/;
    if (!phoneField.value.trim()) {
        errorDiv.textContent = 'Phone number is required';
        errorDiv.style.display = 'block';
        phoneField.classList.add('error');
        return false;
    }
    
    if (!phoneRegex.test(phoneField.value)) {
        errorDiv.textContent = 'Please enter a valid 10-digit phone number';
        errorDiv.style.display = 'block';
        phoneField.classList.add('error');
        return false;
    }
    
    return true;
}

function viewCompleteReport(complaintId) {
    // Show loading state
    document.getElementById('reportContent').innerHTML = `
        <div style="text-align: center; padding: 40px;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p style="margin-top: 10px;">Loading report...</p>
        </div>
    `;
    
    // Show the modal while loading
    const modal = new bootstrap.Modal(document.getElementById('completeReportModal'));
    modal.show();
    
    // Fetch the complete report data
    fetch(`/get-complete-report/${complaintId}/`)
        .then(response => {
            if (!response.ok) {
                return response.json().then(err => {
                    throw new Error(`Server error: ${err.error || response.statusText}`);
                });
            }
            return response.json();
        })
        .then(data => {
            console.log("Report data:", data); // Debugging
            // Format the report content
            const reportContent = `
                <div class="report-document">
                    <!-- Header -->
                    <div class="report-header">
                        <div class="report-title">
                            <h1>FIR REPORT</h1>
                            <p class="report-number">FIR No: ${data.id}</p>
                        </div>
                        <div class="police-station-info">
                            <h3>${data.police_station.name} Police Station</h3>
                            <p>${data.police_station.district} District</p>
                            <p>Contact: ${data.police_station.contact}</p>
                        </div>
                    </div>

                    <!-- Complainant Details -->
                    <div class="report-section">
                        <h2>1. Complainant Details</h2>
                        <div class="section-content">
                            <div class="detail-row">
                                <span class="label">Name:</span>
                                <span class="value">${data.user.first_name} ${data.user.last_name}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Contact:</span>
                                <span class="value">${data.user.phone || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Aadhaar Number:</span>
                                <span class="value">${data.user.adhaar || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Date of Birth:</span>
                                <span class="value">${data.user.date_of_birth || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Gender:</span>
                                <span class="value">${data.user.gender || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Address:</span>
                                <span class="value">${data.user.address || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">District:</span>
                                <span class="value">${data.user.district || 'Not provided'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Pincode:</span>
                                <span class="value">${data.user.pincode || 'Not provided'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Complaint Details -->
                    <div class="report-section">
                        <h2>2. Complaint Details</h2>
                        <div class="section-content">
                            <div class="detail-row">
                                <span class="label">Type of Complaint:</span>
                                <span class="value">${data.complaint_type}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Date Reported:</span>
                                <span class="value">${data.date_reported}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Incident Date:</span>
                                <span class="value">${data.incident_date}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Incident Time:</span>
                                <span class="value">${data.incident_time}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Location of Incident:</span>
                                <span class="value">${data.location}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Status:</span>
                                <span class="value">${data.status}</span>
                            </div>
                            <div class="detail-row">
                                <span class="label">Description:</span>
                                <span class="value">${data.description}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence -->
                    <div class="report-section">
                        <h2>3. Evidence</h2>
                        <div class="section-content">
                            ${data.evidence.length > 0 ? `
                                <div class="evidence-list">
                                    ${data.evidence.map((ev, index) => `
                                        <div class="evidence-item">
                                            <div class="detail-row">
                                                <span class="label">Evidence ${index + 1}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">Date Added:</span>
                                                <span class="value">${ev.uploaded_at}</span>
                                            </div>
                                            ${ev.file ? `
                                                <div class="detail-row">
                                                    <span class="label">File:</span>
                                                    <span class="value"><a href="${ev.file}" target="_blank">View Evidence</a></span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p class="no-data">No evidence added yet.</p>'}
                        </div>
                    </div>

                    <!-- Witnesses -->
                    <div class="report-section">
                        <h2>4. Witnesses</h2>
                        <div class="section-content">
                            ${data.witnesses.length > 0 ? `
                                <div class="witnesses-list">
                                    ${data.witnesses.map((witness, index) => `
                                        <div class="witness-item">
                                            <div class="detail-row">
                                                <span class="label">Witness ${index + 1}:</span>
                                                <span class="value">${witness.name}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">Contact:</span>
                                                <span class="value">${witness.phone}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">Added on:</span>
                                                <span class="value">${witness.added_at}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p class="no-data">No witnesses recorded yet.</p>'}
                        </div>
                    </div>
                    
                    <!-- Additional Descriptions -->
                    <div class="report-section">
                        <h2>5. Investigation Updates</h2>
                        <div class="section-content">
                            ${data.additional_descriptions && data.additional_descriptions.length > 0 ? `
                                <div class="descriptions-list">
                                    ${data.additional_descriptions.map((desc, index) => `
                                        <div class="description-item">
                                            <div class="detail-row">
                                                <span class="label">Date & Time:</span>
                                                <span class="value">${desc.created_at}</span>
                                            </div>
                                            <div class="detail-row">
                                                <span class="label">Description:</span>
                                                <span class="value">${desc.description}</span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p class="no-data">No additional investigation updates recorded yet.</p>'}
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="report-footer">
                        <div class="signature-section">
                            <div class="signature-line"></div>
                            <p>Investigating Officer</p>
                            <p>${data.police_station.name} Police Station</p>
                        </div>
                        <div class="report-date">
                            <p>Date: ${new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                        </div>
                    </div>
                </div>

                <style>
                    .report-document {
                        font-family: 'Times New Roman', Times, serif;
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 40px;
                        background: white;
                        box-shadow: 0 0 10px rgba(0,0,0,0.1);
                    }

                    .report-header {
                        text-align: center;
                        margin-bottom: 40px;
                        border-bottom: 2px solid #000;
                        padding-bottom: 20px;
                    }

                    .report-title h1 {
                        font-size: 24px;
                        margin-bottom: 10px;
                    }

                    .report-number {
                        font-size: 16px;
                        color: #666;
                    }

                    .police-station-info {
                        margin-top: 20px;
                    }

                    .police-station-info h3 {
                        font-size: 18px;
                        margin-bottom: 5px;
                    }

                    .report-section {
                        margin-bottom: 30px;
                    }

                    .report-section h2 {
                        font-size: 18px;
                        border-bottom: 1px solid #ccc;
                        padding-bottom: 5px;
                        margin-bottom: 15px;
                    }

                    .section-content {
                        padding: 0 10px;
                    }

                    .detail-row {
                        margin-bottom: 10px;
                        display: flex;
                        flex-wrap: wrap;
                    }

                    .label {
                        font-weight: bold;
                        width: 150px;
                        margin-right: 10px;
                    }

                    .value {
                        flex: 1;
                        min-width: 200px;
                    }

                    .evidence-item, .witness-item, .description-item {
                        background: #f9f9f9;
                        padding: 15px;
                        margin-bottom: 15px;
                        border-radius: 5px;
                    }
                    
                    .description-item {
                        border-left: 4px solid #3F51B5;
                    }
                    
                    .descriptions-list {
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                    }

                    .report-footer {
                        margin-top: 50px;
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-end;
                    }

                    .signature-section {
                        text-align: center;
                    }

                    .signature-line {
                        width: 200px;
                        border-bottom: 1px solid #000;
                        margin: 50px auto 10px;
                    }

                    .no-data {
                        color: #666;
                        font-style: italic;
                    }

                    @media print {
                        .report-document {
                            box-shadow: none;
                            padding: 0;
                        }
                    }
                </style>
            `;
            
            // Update the modal content
            document.getElementById('reportContent').innerHTML = reportContent;
        })
        .catch(error => {
            document.getElementById('reportContent').innerHTML = `
                <div class="alert alert-danger" role="alert">
                    Error loading report: ${error.message}
                </div>
            `;
        });
}
</script>
{% endblock %}